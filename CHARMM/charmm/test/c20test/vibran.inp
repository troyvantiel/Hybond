* TESTS A NUMBER OF VIBRAN COMMANDS
*

! tries to constrain bonds across parallel partition boundaries
! VIBRAN and quasi are not parallel
if ?NUMNODE .gt. 1 then
 echo "Test NOT performed."
 stop
endif

if ?novibran .eq. 1 then
 echo "Test NOT performed."
 stop
endif

stream datadir.def

OPEN READ FORM UNIT 11 NAME  @0toph9.rtf
READ RTF  CARD UNIT 11
CLOSE UNIT 11
BOMLEV -2
OPEN READ FORM UNIT 12 NAME  @0param6.prm
READ PARAM CARD UNIT 12
CLOSE UNIT 12
BOMLEV -1

READ SEQUENCE CARDS
* TRYPTOPHAN
*
    1
TRP
GENERATE TRYP setup

OPEN WRITE FILE UNIT 18 NAME @9FOR018.DAT
WRITE PSF FILE UNIT 18
* TRYPTOPHAN USING EXPLICIT HYDROGEN
*

ic purge

READ COORD CARDS
* TRYPTOPHAN BUILT AND MINIMIZED WITH SD 50 STEPS, ABNR 500 STEP,
* AND CG 50 STEPS, EPS=R POTENTIAL
*
   19
    1    1 TRP  HT1    0.10124   0.57409  -1.38529
    2    1 TRP  HT2    1.71114   0.43637  -1.90440
    3    1 TRP  N      1.06717   0.30225  -1.10075
    4    1 TRP  HT3    1.07999  -0.68894  -0.79051
    5    1 TRP  CA     1.47212   1.19190   0.02727
    6    1 TRP  CB     2.69565   2.02615  -0.34753
    7    1 TRP  CG     3.92166   1.16873  -0.67893
    8    1 TRP  CD1    4.81252   0.77506   0.29018
    9    1 TRP  CD2    4.29511   0.67909  -1.89046
   10    1 TRP  NE1    5.72693   0.04608  -0.32026
   11    1 TRP  HE1    6.09389  -0.74349   0.12669
   12    1 TRP  CE2    5.42381  -0.01032  -1.60094
   13    1 TRP  CE3    3.76875   0.77367  -3.15481
   14    1 TRP  CZ2    6.13756  -0.67683  -2.56270
   15    1 TRP  CZ3    4.47167   0.10800  -4.14811
   16    1 TRP  CH2    5.63634  -0.60503  -3.85644
   17    1 TRP  C      0.27986   2.11295   0.30889
   18    1 TRP  OT1   -0.40216   2.48057  -0.63623
   19    1 TRP  OT2   -0.10570   2.19226   1.45887

mini abnr nstep 100 nprint 10  CUTNB 100.0 CTONNB 99.0 CTOFNB 99.5
COOR ORIE MASS

OPEN WRITE FILE UNIT 17 NAME @9FOR017.DAT
WRITE COOR FILE UNIT 17
* TRYPTOPHAN MINIMIZED FOR VIBRAN TEST CASE
*

SHAKE BOND

!!!!! 1 marker for the first section of vibran testing
VIBRAN NMOD 60
DIAG
PRINT NORM
DIAG RAISE
PRINT NORM

!!!!! 2 second section of vibran
PRINT NORM MODE 1 THRU 2  TEMP 300.0  VECT
PRINT NORM MODE 1 THRU 2  TEMP 300.0  INTD
PRINT NORM MODE 1 THRU 2  TEMP 300.0  DOTP
PRINT NORM MODE 1 THRU 2  TEMP 300.0  DIPO
PRINT NORM MODE 1 THRU 2  TEMP 300.0  STAT

!!!!! 3 third section
PROJ USER 1  MODE 1 THRU 10 TEMP 300.0
PROJ USER 1  MODE 1 THRU 57 TEMP 300.0
PROJ FORCE   MODE 1 THRU 57 TEMP 300.0
PROJ DIHE 1 CA 1 CB 1 CG 1 CD1  MODE 1 THRU 57 TEMP 300.0
PROJ DIHE 1 C 1 CA 1 CB 1 CG  MODE 1 THRU 57 TEMP 300.0
PROJ ANGLE 1 OT1 1 C 1 OT2  MODE 1 THRU 57 TEMP 300.0
PROJ BOND 1 CB 1 CG  MODE 1 THRU 57 TEMP 300.0

!!!!! 4 fourth section
FLUCT ATOM MODE 1 THRU 57 TEMP 300.0 SELE ALL END
FLUCT ATOM MODE 1 THRU 57 TEMP 300.0 SELE TYPE CA END
FLUCT ATOM MODE 1 THRU 57 TEMP 300.0 SELE TYPE CA END QUANT
FLUCT IC MODE 1 THRU 57 TEMP 300.0
OPEN WRITE CARD UNIT 17 NAME @9FOR017.DAT
FLUCT USER MODE 1 THRU 57 TEMP 300.0

!!!!! 5 fifth section
PED MODE 1 THRU 4 TEMP 300.0 TOL 0.01
THERMO TEMP  300.0 STEP 10.0

!!!!! 6 sixth section
!FILL DIFF MODE 1 MRMS 1.0
!GRAMPS
!FRAME SINGLE COMP
!DEFINE VIBRAN NOCE
!BONDS SELE ALL END
!TEXT MODE NUMBER 1
!END ! DEFINE
!END ! GRAMPS
!
!GRAMPS
!FRAME APPEND SINGLE
!DEFINE VIBRAN NOCE
!BONDS SELE ALL END
!TEXT MODE NUMBER 1
!END ! DEFINE
!END ! GRAMPS
!
!COOR AVER COMP FACT 2.0
!GRAMPS
!FRAME APPEND SINGLE
!DEFINE VIBRAN NOCE
!BONDS SELE ALL END
!TEXT MODE NUMBER 1
!END ! DEFINE
!END ! GRAMPS

!!!!! 7 seventh section
EXPLORE MODE 1 MRMS 0.5 GRID 11 ADJU
EXPLORE MODE 1 MRMS 0.5 GRID 11 SHAKE ADJU
EXPLORE MODE 1 MRMS 0.5 GRID 11 SHAKE ADJU BOLTZ 300.0
EXPLORE MODE 1 MRMS 0.5 GRID 11 SHAKE ADJU GAUSS 4.0
EXPLORE MODE 1 MRMS 0.5 GRID 11 SHAKE ADJU GAUSS 40.0
EXPLORE MODE 1 MRMS 0.5 GRID 11 SHAKE ADJU BOLTZ 300.0 GAUSS 4.0

!!!!! 8 eighth section
PRINT NORM MODE 1 THRU 5
RAYLEIG MODE 1 THRU 20 SAVE
PRINT NORM  MODE 1 THRU 5

!!!!! 9 eighth section
EDIT DELETE MODE 1 THRU 100
EDIT INCL DIHE 1 CA 1 CB 1 CG 1 CD1
EDIT INCL DIHE 1 C 1 CA 1 CB 1 CG
EDIT INCL ANGLE 1 OT1 1 C 1 OT2
EDIT INCL BOND 1 CB 1 CG
RAYLEIG SAVE
PRINT NORM MODE 1 THRU 4  MRMS 1.0 INTD
END
STOP
