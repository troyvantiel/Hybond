* TEST FOR DIMS
* Author: Juan Roberto Perilla
* This test case is for Protein-A (1BDC). From unfolded to folded.
*

if ?NUMNODE .gt. 1 then
  echo "Test NOT performed."
  stop
endif

if ?DIMS .NE. 1 THEN
  echo "Test NOT Performed."
  STOP
endif

stream datadir.def

OPEN READ FORM UNIT 11 NAME  @0top_all22_prot.inp
READ RTF  CARD UNIT 11
close unit 11

OPEN READ FORM UNIT 12 NAME  @0par_all22_prot.inp 
READ PARAM CARD UNIT 12
close unit 12

! READ SEQUENCE AND GENERATE PSF
OPEN READ CARD UNIT 1 NAME @01bdc_dims_start.pdb
READ SEQUENCE COOR PDB UNIT 1
GENERATE 1BDC SETUP FIRST NTER LAST CTER
CLOSE UNIT 1

! DIMS GOES FROM "COOR" TO "DIMS" 

! READ TARGET STRUCTURE
OPEN READ CARD UNIT 1 NAME @01bdc_dims_targ.pdb
READ COORD PDB UNIT 1
CLOSE UNIT 1

COOR COPY DIMS

! READ INITIAL STRUCTURE
OPEN READ CARD UNIT 1 NAME @01bdc_dims_start.pdb
READ COORD PDB UNIT 1
CLOSE UNIT 1

SHAKE BONH PARAm TOL 1.0e-6

! Test BNM-DIMS first

! DIMS Parameters
SET ORIENT = 10
SET COFF = 0.5
!    Bias parameters
SET SCALING = 0.0025
SET DTOL = 0.5
SET SKIP = 200
SET BSKIP = 45
SET NBIAS = 30

! BNM Memory management / change accordingly
! 
SET TMEM = 256
SET MEMO = 20
SET MEMA = 30
! Combinatorial parameters
SET NMOD = 20
SET NBES = 10
SET COMB = 3
! Self avoidance
SET MTRA = -1
SET NMUN = 35
SET NWIND = 0
SET DSUN = -1


OPEN WRITE UNIT @{NMUN} CARD NAME @91bdcSA.dat
!WRITE TITLE UNIT @{NMUN}
!** Self avoidance file run0-2
!**

DIMS	DBNM HALT   DSCALE  @{SCALING}	DTOL 	@{DTOL}	   NMFIRST	    -
	SKIP	@{SKIP}		BSKIP 	@{BSKIP}   NBIAS   @{NBIAS} -
	SERL	GENR	SCAL 	0.5882	TMEM 	@{TMEM}    MEMA	   @{MEMA}  -
	MEMO   	@{MEMO} ORIENT	@{ORIENT} -
	NMOD	@{NMOD}	COFF	@{COFF}	NBES	@{NBES}	   COMB	   @{COMB}  -
	SCAV    10	MTRA	@{MTRA}	NMUN	@{NMUN}	   NWIND   @{NWIND} -
	DSUN	@{DSUN} SELECT ALL END

! Enable self avoidance
SCALAR FBETA SET 50.0
SCALAR FBETA SET 0.0  select type H* end

OPEN WRITE UNIT 20 UNFORM NAME @91bdc.dcd

DYNA	LEAP	LANG	START	NSTEP   100	TIMESTEP 0.001 	 -
	IPRFRQ  5000	IHTFRQ	0	IEQFRQ	0	NTRFQ	0 	 -
	IUNREAD	-1	IUNWRI -1	IUNCRD	20	 -
	IUNVEL	-1	KUNIT  	-1		ISEED  945762	 -
	NPRINT  10		NSAVC  	50		NSAVV 0    -
	IHBFRQ  -1		INBFRQ 	-1		ILBFRQ  10000 	 -
	RBUFFER	0.0   		TBATH	300		FIRSTT 	300 -
	FINALT 300 	 	ECHECK	-1		IASORS 	0  -
	IASVEL 	1 ISCVEL 0 ICHECW 0 

CLOSE UNIT 20
CLOSE UNIT 35

! Test Self-avoidance
DIMS	DBNM HALT   DSCALE  @{SCALING}	DTOL 	@{DTOL}	   NMFIRST	    -
	SKIP	@{SKIP}		BSKIP 	@{BSKIP}   NBIAS   @{NBIAS}         -
	SERL	GENR	SCAL 	0.5882	TMEM 	@{TMEM}    MEMA	   @{MEMA}  -
	MEMO   	@{MEMO} ORIENT	@{ORIENT} NMOD	@{NMOD}	COFF	@{COFF}	 -
        NBES	@{NBES}	   COMB	   @{COMB}  -
	SCAV    10	MTRA	1	NMUN	@{NMUN}	   NWIND   @{NWIND} -
	DSUN	@{DSUN} SELECT ALL END

OPEN READ UNIT 19 CARD NAME @91bdcSA.dat
READ NM UNIT 19 
CLOSE unit 19
OPEN APPEND UNIT @{NMUN} CARD NAME @91bdcSA.dat

OPEN WRITE UNIT 20 UNFORM NAME @91bdc1.dcd

DYNA	LEAP	LANG	START	NSTEP   100	TIMESTEP 0.001 	 -
	IPRFRQ  5000	IHTFRQ	0	IEQFRQ	0	NTRFQ	0 	 -
	IUNREAD	-1	IUNWRI -1	IUNCRD	20	 -
	IUNVEL	-1	KUNIT  	-1		ISEED  945762	 -
	NPRINT  10		NSAVC  	50		NSAVV 0    -
	IHBFRQ  -1		INBFRQ 	-1		ILBFRQ  10000 	 -
	RBUFFER	0.0   		TBATH	300		FIRSTT 	300 -
	FINALT 300 	 	ECHECK	-1		IASORS 	0  -
	IASVEL 	1 ISCVEL 0 ICHECW 0 

CLOSE UNIT 20
CLOSE UNIT 35


! Test Self-avoidance 2
DIMS	DBNM HALT   DSCALE  @{SCALING}	DTOL 	@{DTOL}	   NMFIRST	    -
	SKIP	@{SKIP}		BSKIP 	@{BSKIP}   NBIAS   @{NBIAS}         -
	SERL	GENR	SCAL 	0.5882	TMEM 	@{TMEM}    MEMA	   @{MEMA}  -
	MEMO   	@{MEMO} ORIENT	@{ORIENT} NMOD	@{NMOD}	COFF	@{COFF}	 -
        NBES	@{NBES}	   COMB	   @{COMB}  -
	SCAV    10	MTRA	2	NMUN	@{NMUN}	   NWIND   @{NWIND} -
	DSUN	@{DSUN} SELECT ALL END

OPEN READ UNIT 19 CARD NAME @91bdcSA.dat
READ NM UNIT 19 
CLOSE unit 19
OPEN APPEND UNIT @{NMUN} CARD NAME @91bdcSA.dat

OPEN WRITE UNIT 20 UNFORM NAME @91bdc2.dcd

DYNA	LEAP	LANG	START	NSTEP   100	TIMESTEP 0.001 	 -
	IPRFRQ  5000	IHTFRQ	0	IEQFRQ	0	NTRFQ	0 	 -
	IUNREAD	-1	IUNWRI -1	IUNCRD	20	 -
	IUNVEL	-1	KUNIT  	-1		ISEED  945762	 -
	NPRINT  10		NSAVC  	50		NSAVV 0    -
	IHBFRQ  -1		INBFRQ 	-1		ILBFRQ  10000 	 -
	RBUFFER	0.0   		TBATH	300		FIRSTT 	300 -
	FINALT 300 	 	ECHECK	-1		IASORS 	0  -
	IASVEL 	1 ISCVEL 0 ICHECW 0 

CLOSE UNIT 20
CLOSE UNIT 35

! Test Self-avoidance 3
DIMS	DBNM HALT   DSCALE  @{SCALING}	DTOL 	@{DTOL}	   NMFIRST	    -
	SKIP	@{SKIP}		BSKIP 	@{BSKIP}   NBIAS   @{NBIAS}         -
	SERL	GENR	SCAL 	0.5882	TMEM 	@{TMEM}    MEMA	   @{MEMA}  -
	MEMO   	@{MEMO} ORIENT	@{ORIENT} NMOD	@{NMOD}	COFF	@{COFF}	 -
        NBES	@{NBES}	   COMB	   @{COMB}  -
	SCAV    10	MTRA	3	NMUN	@{NMUN}	   NWIND   @{NWIND} -
	DSUN	@{DSUN} SELECT ALL END

OPEN READ UNIT 19 CARD NAME @91bdcSA.dat
READ NM UNIT 19 
CLOSE unit 19
OPEN APPEND UNIT @{NMUN} CARD NAME @91bdcSA.dat

OPEN WRITE UNIT 20 UNFORM NAME @91bdc3.dcd

DYNA	LEAP	LANG	START	NSTEP   100	TIMESTEP 0.001 	 -
	IPRFRQ  5000	IHTFRQ	0	IEQFRQ	0	NTRFQ	0 	 -
	IUNREAD	-1	IUNWRI -1	IUNCRD	20	 -
	IUNVEL	-1	KUNIT  	-1		ISEED  945762	 -
	NPRINT  10		NSAVC  	50		NSAVV 0    -
	IHBFRQ  -1		INBFRQ 	-1		ILBFRQ  10000 	 -
	RBUFFER	0.0   		TBATH	300		FIRSTT 	300 -
	FINALT 300 	 	ECHECK	-1		IASORS 	0  -
	IASVEL 	1 ISCVEL 0 ICHECW 0 

CLOSE UNIT 20
CLOSE UNIT 35



stop
